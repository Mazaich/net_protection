# net_protection
Домашнее задание по теме "Защита сети" - Машаев Роман

Задание 1
Проведите разведку системы и определите, какие сетевые службы запущены на защищаемой системе:
sudo nmap -sA < ip-адрес >
sudo nmap -sT < ip-адрес >
sudo nmap -sS < ip-адрес >
sudo nmap -sV < ip-адрес >
По желанию можете поэкспериментировать с опциями: https://nmap.org/man/ru/man-briefoptions.html.
В качестве ответа пришлите события, которые попали в логи Suricata и Fail2Ban, прокомментируйте результат.

ОТВЕТ:

Для решения задачи в нашем конкретомн случае используем две отдельные физические машины. Одна атакующая (Kali Linux) с IP-адресом
192.168.1.217 и атакуемая (Ubuntu) c IP-адесом 192.168.1.216

<<<<<<< HEAD
Использование утилиты suricata:

В логах Suricata (fast.log) имеются различные предупреждения. 
1.	"SURICATA Applayer Detect protocol only one direction" — это означает, что Suricata обнаружил протокол только в одном направлении (например, клиент-сервер), но не в обратном. 
2.	Несколько предупреждений "SURICATA HTTP unable to match response to request" — Suricata не может сопоставить ответ HTTP с запросом. Это может происходить из-за таймаутов, потери пакетов или аномалий в трафике.
3.	"SURICATA Applayer Mismatch protocol both directions" — Suricata обнаружил несоответствие протокола в обоих направлениях. Например, в одном направлении трафик выглядит как HTTP, а в обратном — как другой протокол.
4.	"SURICATA HTTP request field missing colon" — в HTTP-запросе отсутствует двоеточие в заголовке. Это указывает на неправильно сформированный HTTP-запрос.
5.	"SURICATA HTTP request missing protocol" — в HTTP-запросе отсутствует протокол (например, HTTP/1.1).
6.	"SURICATA HTTP missing Host header" — в HTTP-запросе отсутствует заголовок Host, который обязателен для HTTP/1.1.
7.	Множество предупреждений "ET SCAN Possible Nmap User-Agent Observed" — это срабатывание правил Emerging Threats на сканирование с помощью Nmap. Nmap использует свой собственный User-Agent, который легко распознается.
Из IP-адресов видно, что есть два узла: 192.168.1.216 и 192.168.1.217.
•	192.168.1.217 инициирует соединения на 192.168.1.216 на порты 9000, 8080, 80.
•	Предупреждения о Nmap указывают на то, что 192.168.1.217 проводит сканирование веб-сервисов на 192.168.1.216.
Из вышеуказанного можно сделать вывод:На машине 192.168.1.217 запущено сканирование (вероятно, с помощью Nmap) веб-серверов на 192.168.1.216.При этом сканирование вызывает множество предупреждений Suricata, связанных с HTTP, потому что Nmap отправляет нестандартные или неполные HTTP-запросы для определения служб. Также есть проблемы с сопоставлением запросов и ответов, что может быть связано с особенностями сканирования. 



В логах eve.json видно несколько событий, связанных с IP-адресом 192.168.1.217, который обращается к 192.168.1.216 на различные порты (8080, 9000, 80) с использованием User-Agent, характерного для Nmap Scripting Engine:
1.	Сработавшие сигнатуры:
Несколько раз сработала сигнатура ET SCAN Possible Nmap User-Agent Observed (ID 2024364). Это сигнализирует о том, что в HTTP-запросах используется User-Agent, который обычно ассоциируется с Nmap.
2.	HTTP-запросы с User-Agent Nmap:
Запросы к порту 8080 на пути /HNAP1, /evox/about и другие.
Запросы к порту 9000 на пути /NmapUpperCheck1761832443, /Nmap/folder/check1761832443 и корневой путь /.
Запросы к порту 80 на пути /HNAP1, /evox/about и корневой путь /.
3.	Ответы от сервера:
На некоторые запросы сервер отвечает кодом 404 (Не найдено), на некоторые 200 (Успешно).
4.	Статистика:
В логах также присутствует статистика Suricata, которая показывает, что было обработано 33265 пакетов, из которых 25477 TCP и 5957 UDP.
Тким образом вывод:
=======
Использование утилиты SURICATA:

В логах Suricata (fast.log) имеются различные предупреждения. 
1."SURICATA Applayer Detect protocol only one direction" — это означает, что Suricata обнаружил протокол только в одном направлении (например, клиент-сервер), но не в обратном. 
2.Несколько предупреждений "SURICATA HTTP unable to match response to request" — Suricata не может сопоставить ответ HTTP с запросом. Это может происходить из-за таймаутов, потери пакетов или аномалий в трафике.
3."SURICATA Applayer Mismatch protocol both directions" — Suricata обнаружил несоответствие протокола в обоих направлениях. Например, в одном направлении трафик выглядит как HTTP, а в обратном — как другой протокол.
4."SURICATA HTTP request field missing colon" — в HTTP-запросе отсутствует двоеточие в заголовке. Это указывает на неправильно сформированный HTTP-запрос.
5."SURICATA HTTP request missing protocol" — в HTTP-запросе отсутствует протокол (например, HTTP/1.1).
6."SURICATA HTTP missing Host header" — в HTTP-запросе отсутствует заголовок Host, который обязателен для HTTP/1.1.
7.Множество предупреждений "ET SCAN Possible Nmap User-Agent Observed" — это срабатывание правил Emerging Threats на сканирование с помощью Nmap. Nmap использует свой собственный User-Agent, который легко распознается.
Из IP-адресов видно, что есть два узла: 192.168.1.216 и 192.168.1.217.
192.168.1.217 инициирует соединения на 192.168.1.216 на порты 9000, 8080, 80.
Предупреждения о Nmap указывают на то, что 192.168.1.217 проводит сканирование веб-сервисов на 192.168.1.216.
Из вышеуказанного можно сделать вывод:На машине 192.168.1.217 запущено сканирование (вероятно, с помощью Nmap) веб-серверов на 192.168.1.216.При этом сканирование вызывает множество предупреждений Suricata, связанных с HTTP, потому что Nmap отправляет нестандартные или неполные HTTP-запросы для определения служб. Также есть проблемы с сопоставлением запросов и ответов, что может быть связано с особенностями сканирования. 


В логах eve.json видно несколько событий, связанных с IP-адресом 192.168.1.217, который обращается к 192.168.1.216 на различные порты (8080, 9000, 80) с использованием User-Agent, характерного для Nmap Scripting Engine:
1.Сработавшие сигнатуры:
Несколько раз сработала сигнатура ET SCAN Possible Nmap User-Agent Observed (ID 2024364). Это сигнализирует о том, что в HTTP-запросах используется User-Agent, который обычно ассоциируется с Nmap.
2.HTTP-запросы с User-Agent Nmap:
Запросы к порту 8080 на пути /HNAP1, /evox/about и другие.
Запросы к порту 9000 на пути /NmapUpperCheck1761832443, /Nmap/folder/check1761832443 и корневой путь /.
Запросы к порту 80 на пути /HNAP1, /evox/about и корневой путь /.
3.Ответы от сервера:
На некоторые запросы сервер отвечает кодом 404 (Не найдено), на некоторые 200 (Успешно).
4.Статистика:
В логах также присутствует статистика Suricata, которая показывает, что было обработано 33265 пакетов, из которых 25477 TCP и 5957 UDP.

Тaким образом вывод:
Есть признаки сканирования с IP-адреса 192.168.1.217. Использование User-Agent, характерного для Nmap, и обращение к различным портам и путям на целевом хосте 192.168.1.216 указывает на то, что, вероятно, проводится сканирование веб-сервисов с помощью инструмента Nmap (в частности, с использованием его скриптовых возможностей).
Однако стоит отметить, что сигнатура, которая сработала, имеет низкую серьезность (severity 1) и категорию "Web Application Attack", но на самом деле это скорее информационное событие, указывающее на возможное сканирование.
Есть явные признаки сканирования сети с адреса 192.168.1.217
Это типичное поведение сетевого сканера, проводящего разведку и поиск уязвимостей в сети.

Скриншоты:
1. ![Скриншот](https://github.com/Mazaich/net_protection/blob/main/Screenshot_2025-10-30_17_21_48.png?raw=true)
2. ![Скриншот](https://github.com/Mazaich/net_protection/blob/main/Screenshot_2025-10-30_17_22_00.png?raw=true)
3. ![Скриншот](https://github.com/Mazaich/net_protection/blob/main/Screenshot%20from%202025-10-30%2013-52-48.png?raw=true)
4. ![Скриншот](https://github.com/Mazaich/net_protection/blob/main/Screenshot%20from%202025-10-30%2013-52-58.png?raw=true)



Задание 2
Проведите атаку на подбор пароля для службы SSH:
hydra -L users.txt -P pass.txt < ip-адрес > ssh
Настройка hydra:
создайте два файла: users.txt и pass.txt;
в каждой строчке первого файла должны быть имена пользователей, второго — пароли. В нашем случае это могут быть случайные строки, но ради эксперимента можете добавить имя и пароль существующего пользователя.
Дополнительная информация по hydra: https://kali.tools/?p=1847.
Включение защиты SSH для Fail2Ban:
открыть файл /etc/fail2ban/jail.conf,
найти секцию ssh,
установить enabled в true.
Дополнительная информация по Fail2Ban:https://putty.org.ru/articles/fail2ban-ssh.html.
В качестве ответа пришлите события, которые попали в логи Suricata и Fail2Ban, прокомментируйте результат.


Ответ:

В логах Fail2Ban видим, что Fail2Ban запускался несколько раз (28, 30, 31 октября), была создана джаил для sshd, которая использует systemd для мониторинга логов SSH. 31 октября в 12:56 и 14:37 был забанен IP-адрес 192.168.1.216 за множественные попытки подключения по SSH.
Ключевые события:
В 12:56:28 Fail2Ban обнаружил несколько неудачных попыток входа с IP 192.168.1.216 (более 5 в течение 10 минут) и заблокировал его на 600 секунд (10 минут).
В 13:00:30 Fail2Ban был остановлен, и блокировка была снята (unban).
В 14:36:45 Fail2Ban перезапустился.
В 14:37:36 снова произошла серия неудачных попыток с того же IP, и он был снова забанен.

Fail2Ban успешно работает и блокирует IP-адреса, с которых происходит подбор паролей по SSH. В данном случае IP 192.168.1.216 дважды был заблокирован за подозрительную активность.

Таким образом: обнаружена атака brute-force
IP-адрес 192.168.1.216 совершил множественные попытки подключения:
Первая атака (31 октября 12:56):
Обнаружено более 20 неудачных попыток за 4 секунды
Превышен лимит maxretry = 5 в течение findtime = 600 секунд
Результат: IP забанен на 600 секунд (10 минут)
Вторая атака (31 октября 14:37):
Повторная серия из 25+ попыток за 5 секунд
Снова превышен лимит попыток
Результат: IP снова забанен

Fail2Ban работает правильно - обнаруживает и блокирует атаки, имела место активность brute-force - кто-то пытался подобрать пароли SSH, система защищена - атакующий IP блокируется автоматически.


=======
>>>>>>> b5919f84909a247a6c0f3874a443a34ec6cfdfa9


